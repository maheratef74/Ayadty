
@{
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

@using Microsoft.AspNetCore.Builder
@using Microsoft.AspNetCore.Mvc.Localization
@using Microsoft.Extensions.Options
@inject IViewLocalizer localizer
@using System.Globalization
@using presentationLayer.Models.Clinic.ActionRequst
@using presentationLayer.Models.Clinic.ViewModel

@model UpdateClinicVM

<!DOCTYPE html>
<head>
    <title>Profile Page</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="~/css/ClinicUpdate.css" />
</head>
<body>
    <form asp-controller="Clinic" asp-action="Update" method="post">
        <div class="container">
            <div class="main-body">
                <div class="row">
                    <div class="col-lg-4">
                        <div class="card">
                            <div class="card-body">
                                <div class="d-flex flex-column align-items-center text-center">

                                    <!-- Profile Image -->
                                    <div>
                                        @if (Model.ProfilePhoto != null)
                                        {
                                            <img id="profilePhoto" src="@Model.ProfilePhoto" alt="Clinic Photo" style="max-width: 300px; max-height: 300px;" />
                                        }
                                    </div>

                                    <div class="mt-3">
                                        <h4>Hamed</h4>
                                        <p class="text-secondary mb-1">@localizer["Full Stack Developer"]</p>
                                        <p class="text-muted font-size-sm">@localizer["Bay Area, San Francisco, CA"]</p>
                                        <!-- Button to trigger file input -->
                                        <button type="button" class="btn btn-info" onclick="document.getElementById('photoInput').click()">@localizer["Change Photo"]</button>
                                        <!-- Hidden file input -->
                                        <input type="file" id="photoInput" name="photo" accept="image/*" style="display:none" onchange="uploadPhoto(event)">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-8">
                        <div class="card">
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-sm-3">
                                        <h6 class="mb-0">@localizer["Full Name"]</h6>
                                    </div>
                                    <div class="col-sm-9 text-secondary">
                                        <!-- Bind input to Name in the model -->
                                        <input asp-for="Name" type="text" class="form-control" value="@Model.Name" />
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-sm-3">
                                        <h6 class="mb-0">@localizer["Mobile"]</h6>
                                    </div>
                                    <div class="col-sm-9 text-secondary">
                                        <!-- Bind input to Phone in the model -->
                                        <input asp-for="Phone" type="text" class="form-control" value="@Model.Phone" />
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-sm-3">
                                        <h6 class="mb-0">@localizer["Email"]</h6>
                                    </div>
                                    <div class="col-sm-9 text-secondary">
                                        <!-- Bind input to Email in the model -->
                                        <input asp-for="Email" type="text" class="form-control" value="@Model.Email" />
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-sm-3">
                                        <h6 class="mb-0">@localizer["Location"]</h6>
                                    </div>
                                    <div class="col-sm-9 text-secondary">
                                        <!-- Bind input to location in the model -->
                                        <input asp-for="location" type="text" class="form-control" value="@Model.location" />
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-sm-3">
                                        <h6 class="mb-0">@localizer["Doctor"]</h6>
                                    </div>
                                    <div class="col-sm-9 text-secondary">
                                        <input type="text" class="form-control" value="@localizer["ahmed"]" />
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-sm-3">
                                        <h6 class="mb-0">@localizer["Facebook"]</h6>
                                    </div>
                                    <div class="col-sm-9 text-secondary">
                                        <input type="text" class="form-control" value="sdakfka@facebook.com" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-3"></div>
                                    <div class="col-sm-9 text-secondary">
                                        <button type="submit" class="btn btn-primary">@localizer["Save Changes"]</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <script>
        // Function to preview and upload the photo
        function uploadPhoto(event) {
            const photo = document.getElementById('profilePhoto');
            const file = event.target.files[0];

            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    photo.src = e.target.result;
                }
                reader.readAsDataURL(file); // Convert image file to base64 string

                // Create form data and send the image to the server via AJAX
                const formData = new FormData();
                formData.append("photo", file);
                formData.append("clinicId", "@Model.Name");

                $.ajax({
                    url: '@Url.Action("SavePhotoPath", "Clinic")',
                    type: 'POST',
                    data: formData,
                    contentType: false,
                    processData: false,
                    success: function (response) {
                        alert("Photo uploaded successfully!");
                    },
                    error: function (xhr, status, error) {
                        alert("Error uploading photo: " + error);
                    }
                });
            }
        }
    </script>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <!-- For Layout -->
    <script src="~/js/jquery.min.js"></script>
    <script src="~/js/main.js"></script>
</body>